# Владение в Rust
*Владением* называют набор правил по которым Rust работает с памятью.

Правила владения:
1. Каждое значение в Rust имеет *владельца*.
2. Единовременно у переменной может быть только один владелец.
3. Когда владелец выходит из области видимости, значение будет убрано.

#### Владение на области видимости
Рассмотрим область видимости для некоторой переменной
```rust
let s = "hi";
```
Переменная `s` ссылеатся на строчный литерал, где значение строки было "захардкожено" в текст нашей программы. Переменная существует начиная с момента когда её определили и до конца текущей области видимости.
```rust
{                 // s не существует здесь, так как ещё не определена
	let s = "hi"; // s существует с данной точки и далее
	
	// выполнение кода с переменной s
}                 // область видимости закрылась, а значит s больше не существует
```
Другими словами
1. Когда `s` попадает в область видимости то она существует
2. Переменная `s` существует до тех пор пока она не выйдет из области видимости.

#### Владение и функции
Механизм передачи значения к функции похож на присваивание значения переменной. Передача переменной к функции будет либо перемещать либо копировать данные, также как делает присвоение. 
Пример:
```rust
fn main() {
    let s = String::from("hello");  // s входит в область видимости

    takes_ownership(s);             // значение s передаётся в функцию...
                                    // ... а значит не действительно уже здесь
                                    
    let x = 5;                      // s входит в область видимости
    
    makes_copy(x);                  // значение x передаётся в функцию,
                                    // но так как тип i32 обладает 
                                    // свойством копирования то всё в 
                                    // порядке
                                    // можно снова использовать переменную

} // Здесь переменная x выходит из области видимости, как и s, но так как значение переменной s было перемещено то ничего особенного не происходит

fn takes_ownership(some_string: String) { // some_string входит в область видимости
    println!("{}", some_string);
} // Здесь some_string выходит из области видимости, вызывается функция drop. Память освобождается.

fn makes_copy(some_integer: i32) { // some_integer входит в область видимости
    println!("{}", some_integer);
} // Здесь some_integer выходит из облати видимости. Ничего особенного не происходит.

```
#### Возвращение значений
Функции(и любые выражения) возвращающие значения, также могут передавать владение.
```rust
fn main() {
    let s1 = gives_ownership();         // gives_ownership перемещает 
                                        // возвращаемое ей значение в s1
                                        
    let s2 = String::from("hello");     // s2 входит в область видимости
    
    let s3 = takes_and_gives_back(s2);  // s2 перемещается в 
                                        // takes_and_gives_back, которая 
                                        // также перемещает свои 
                                        // возвращаемые значения в 
                                        // переменную s3
                                        
} // Здесь s3 выходит из области видимости и память под неё освобождается. 
  // s2 была перемещена а значит ничего не происходит
  // s1 выходит из области видимости и память освобождается.

fn gives_ownership() -> String {            // gives_ownership переместит 
                                            // свои возвращаемые значения 
                                            // в функцию которая их вызовет
                                             
    let some_string = String::from("yours"); // some_string входит в 
                                             // область видимости
    
    some_string                             // some_string возвращается и
                                            // передаётся в функцию которая
                                            // вызывает 
}

// Эта функция берёт String и возвращает его же
fn takes_and_gives_back(a_string: String) -> String { // a_string входит в                                      
                                                      // область видимости
                                                      
    a_string  // a_string возвращается и перемещается в вызывающую функцию
}

```
#### Линки
 [[Области видимости в Rust]],
 [[Клонирование и перемещение значений между переменными]],
 [[Утверждения и Выражения в Rust]],
 [[Функции в Rust]]
#### Тэги
 #Rust 
#### Источники
1. https://doc.rust-lang.org/book/ch04-01-what-is-ownership.html